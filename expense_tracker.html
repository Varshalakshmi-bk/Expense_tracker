<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Personal Expense Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; }
    header {
      background: #2c3e50; padding: 20px; color: white; text-align: center;
    }
    nav {
      display: flex; justify-content: center; gap: 10px;
      background: #34495e; padding: 10px;
    }
    nav button {
      background: #1abc9c; color: white;
      padding: 10px 15px; border: none; border-radius: 5px;
      cursor: pointer; font-size: 16px;
    }
    button.clear-btn { background-color: #e74c3c; }
    .section {
      display: none;
      max-width: 800px; margin: 20px auto; padding: 20px;
      background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .section.active { display: block; }
    input, select, button {
      width: 100%; padding: 10px; margin: 10px 0;
      border-radius: 5px; border: 1px solid #ccc;
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; }
    canvas { max-width: 100%; }
  </style>
</head>
<body>

  <header>
    <h1>Personal Expense Tracker</h1>
  </header>

  <nav>
    <button onclick="showSection('entry')">Add Expense</button>
    <button onclick="showSection('userView')">View By User</button>
  </nav>

  <!-- Add Expense -->
  <div id="entry" class="section active">
    <h2>Add Expense</h2>
    <input id="name" type="text" placeholder="Your Name" required>
    <input id="amount" type="number" placeholder="Amount (INR)" required>
    <input id="date" type="date" required>
    <select id="category" onchange="toggleCustomCategory()">
      <option value="Food">Food</option>
      <option value="Transport">Transport</option>
      <option value="Utilities">Utilities</option>
      <option value="Entertainment">Entertainment</option>
      <option value="Other">Other</option>
    </select>
    <input id="customCategory" placeholder="Enter custom category" style="display:none;" />
    <button onclick="addExpense()">Submit</button>
  </div>

  <!-- User Summary View -->
  <div id="userView" class="section">
    <h2>View by Individual</h2>
    <select id="userSelect" onchange="updateUserView()"></select>

    <div id="userDataSection" style="display:none">
      <h3>Summary</h3>
      <div id="userSummary"></div>

      <h3>Average</h3>
      <div id="userAverage"></div>

      <h3>Chart</h3>
      <canvas id="userChart"></canvas>

      <button class="clear-btn" onclick="deleteUserExpenses()">Delete This User's Expenses</button>
    </div>
  </div>

  <script>
    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    function toggleCustomCategory() {
      const select = document.getElementById("category");
      const customInput = document.getElementById("customCategory");
      customInput.style.display = select.value === "Other" ? "block" : "none";
    }

    function addExpense() {
      const name = document.getElementById("name").value.trim();
      const amount = parseFloat(document.getElementById("amount").value);
      const date = document.getElementById("date").value;
      let category = document.getElementById("category").value;
      const customCategory = document.getElementById("customCategory").value.trim();

      if (category === "Other" && customCategory !== "") {
        category = customCategory;
      }

      if (!name || !amount || !date || !category) {
        alert("Please fill all fields");
        return;
      }

      expenses.push({ name, amount, date, category });
      localStorage.setItem("expenses", JSON.stringify(expenses));
      document.getElementById("name").value = "";
      document.getElementById("amount").value = "";
      document.getElementById("date").value = "";
      document.getElementById("customCategory").value = "";
      document.getElementById("category").value = "Food";
      updateUserDropdown();
    }

    function deleteUserExpenses() {
      const user = document.getElementById("userSelect").value;
      if (!user) return;
      if (!confirm(`Delete all expenses for ${user}?`)) return;
      expenses = expenses.filter(e => e.name !== user);
      localStorage.setItem("expenses", JSON.stringify(expenses));
      updateUserDropdown();
      clearUserView();
    }

    function updateUserDropdown() {
      const select = document.getElementById("userSelect");
      const users = [...new Set(expenses.map(e => e.name))];
      select.innerHTML = `<option value="">-- Select User --</option>`;
      users.forEach(user => {
        select.innerHTML += `<option value="${user}">${user}</option>`;
      });
    }

    function updateUserView() {
      const user = document.getElementById("userSelect").value;
      const section = document.getElementById("userDataSection");
      if (!user) {
        clearUserView();
        section.style.display = "none";
        return;
      }
      const userExpenses = expenses.filter(e => e.name === user);
      section.style.display = "block";

      // Summary
      let summaryHTML = "<table><tr><th>Amount (₹)</th><th>Date</th><th>Category</th></tr>";
      userExpenses.forEach(e => {
        summaryHTML += `<tr><td>₹${e.amount}</td><td>${e.date}</td><td>${e.category}</td></tr>`;
      });
      summaryHTML += "</table>";
      document.getElementById("userSummary").innerHTML = summaryHTML;

      // Average
      const avg = userExpenses.reduce((sum, e) => sum + e.amount, 0) / userExpenses.length;
      document.getElementById("userAverage").innerHTML = `<p>₹${avg.toFixed(2)}</p>`;

      // Chart
      const catSums = {};
      userExpenses.forEach(e => {
        catSums[e.category] = (catSums[e.category] || 0) + e.amount;
      });
      const labels = Object.keys(catSums);
      const data = Object.values(catSums);
      const ctx = document.getElementById("userChart").getContext("2d");
      if (window.userChartObj) window.userChartObj.destroy();
      window.userChartObj = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: ["#f39c12", "#3498db", "#2ecc71", "#9b59b6", "#e74c3c"]
          }]
        }
      });
    }

    function clearUserView() {
      document.getElementById("userSummary").innerHTML = "";
      document.getElementById("userAverage").innerHTML = "";
      if (window.userChartObj) window.userChartObj.destroy();
      document.getElementById("userDataSection").style.display = "none";
    }

    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if (id === "userView") updateUserDropdown();
    }

    updateUserDropdown();
  </script>

</body>
</html>
